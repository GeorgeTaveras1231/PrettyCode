<% environment.context_class.instance_eval { include ApplicationHelper } %>

// this code instantiates the ace editor
$( document ).on( 'page:change', function(){
  var 
    editor    = ace.edit("editor"),
    $textarea = $( 'textarea#gist_content' );

  editor.setValue( $textarea.val(), 1 );

  editor.setTheme("ace/theme/eclipse");
  editor.getSession().setMode("ace/mode/text");

  editor.getSession().on('change', function() {
    $textarea.val(editor.getSession().getValue());
  });


  var gistLanguage       = $('#gist_language'),
      supportedLanguages = JSON.parse('<%= supported_languages.to_json %>');

  var toAceLang = function( lang ){
    switch( lang ){
      case 'C/C++':
        return 'c_cpp';
        break;        
      default:
        return lang.toLowerCase();
    }
  };

  gistLanguage.on('change', function(){
    var 
      $this    = $(this),
      language = $this.val();
    
    if( supportedLanguages.indexOf( language ) >= 0 ){
      editor.session.getUndoManager().markClean();
      editor.getSession().setMode('ace/mode/' + toAceLang( language ) );
    }
  });

  $(".canvas-tool-tip").tooltip();
  $("#opacity-slider .ui-slider-handle").tooltip({
    placement: 'top',
    title: 'Opacity'
  });

  $("#brush-slider .ui-slider-handle").tooltip({
    placement: 'top',
    title: 'Brush Size'
  });


});