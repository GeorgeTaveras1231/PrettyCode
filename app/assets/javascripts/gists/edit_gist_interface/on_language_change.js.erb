// list of supported languages all live in GistsHelper ---------------|
<% environment.context_class.instance_eval { include GistsHelper } %>
//--------------------------------------------------------------------|

JW.CACHE.$document.on( 'page:change', function(){
  var 
    gistLanguage,
    supportedLanguages,
    toAceLang,
    editor,
    language;

  language           = $( '#gist_language' ).val();
  editor             = JW.editor,
  $gistLanguage      = $('#gist_language'),
  supportedLanguages = JSON.parse('<%= supported_languages.to_json %>');

  // handle odd language cases from
  // dropdown -----------------------|
  toAceLang = function( lang ){
    switch( lang ){
      case 'C/C++':
        return 'c_cpp';
        break;
  //                                 |
      default:
        return lang.toLowerCase();
    }
  };
  //---------------------------------|


  editor.getSession().setMode( "ace/mode/" + (toAceLang( language ) || 'text') );

  $gistLanguage.on( 'change', function() {
    // change ace syntax highlighting accordingly to selected
    // language --------------------------------------------------------|
    var 
      $this    = $(this),
      language = $this.val();
    //                                                                  |
    if( supportedLanguages.indexOf( language ) >= 0 ){
      editor.session.getUndoManager().markClean();
      editor.getSession().setMode('ace/mode/' + toAceLang( language ) );
    }
    //------------------------------------------------------------------|
  });
});
